---
domain: EC2
  # Here we define classes, or types of objects
  # and dependencies that exists on the class level
  classes:
    - instance:
        states:
          - created
          - running
          - terminated
        actions:
          - launch
          - start
          - stop
          - terminate
    - volume:
        states:
          created: # volume created
            attributes:
              - volume
          attached_to: # volume attached to instance
            attributes:
              - volume
              - instance

        actions:
          create:
            parameters:
              volume: self
            dependencies: # not created
              - not 'created' in ${self}['statelist']
            statelist:
              add: 'created'

          attach:
            parameters: # volume, instance
              volume: self
              instance: inst
            dependencies:
              - 'created' in ${self}['statelist']
              - 'created' in ${inst}['statelist']
              # volume is created
              # instance is created
              # external depencency requiring the volume to be attached to a particular instance
              #   so, here should be a list of objects the volume depends on with the object states,
              #   necessary to achieve the attached state of the volume
            statelist: # add attached_to instance
              add: 'attached_to ${inst}'

          # detach:
          #   parameters:
          #     # volume
          #     # instance
          #   dependencies:
          #     # all the objects dependent on the volume know that the volume is to be detached;
          #     #   i.e. all the reverse conditions are satisfied
          #   statelist: # not attached_to any instance
          #     # remove_state: ${this}.states['attached_to']

    - filesystem:
        states:
          created:
          mounted:
        actions:
          create:

 # Here we define object and their dependencies
  objects:
    - instance:
      - inst1
    - volume:
        - vol1
