---
variables:
  tmp_dir: /tmp

infrastructure:
  - host: psh05
    housing:
      - application: was_nd_855_app
        state:
          possible:
            - installed:
                do: command to run
                check: command to run
                depends:
                  - application['ibm_im_17_app'].state.installed
                  - file['was_nd_855_file'].state.downloaded
                  - host.state.started
          current: unknown
        components:
          - node: Dmgr
            type: management
            state:
              possible:
                - started:
                    do: command to run
                    check: command to run
                    depends: application.state.installed
                - stopped:
                    do: command to run
                    check: command to run
                    depends: application.state.installed
              current: unknown
          - node: Node1
            type: managed
            state:
              possible:
                - started:
                    do: command to run
                    check: command to run
                    depends: application.components.node['Dmgr'].state.started
                - stopped:
                    do: command to run
                    check: command to run
                    depends: application.components.node['Dmgr'].state.started
              current: unknown
            components:
              - server: Server11
                state:
                  possible:
                    - started:
                        do: command to run
                        check: command to run
                        depends: 
                          - node.state.started
                          - node.components.server['Server13'].state.started
                    - stopped:
                        do: command to run
                        check: command to run
                        depends: node.state.started
                  current: unknown
              - server: Server13
                state:
                  possible:
                    - started:
                        do: command to run
                        check: command to run
                        depends: node.state.started
                    - stopped:
                        do: command to run
                        check: command to run
                        depends: node.state.started
                  current: unknown
              - server: Server13
                sameas: Server12
      - file: was_nd_855_file
        state:
          possible:
            - downloaded:
                do: command to run
                check: command to run
                depends: host.state.started
          current: unknowns
      - application: ibm_im_17_app
        state:
          possible:
            - installed:
                do: command to run
                check: command to run
                depends:
                  - file['ibm_im_17_file'].state.downloaded
                  - host.state.started
          current: unknown
      - file: ibm_im_17_file
        state:
          possible:
            - downloaded:
                do: command to run
                check: command to run
                depends: host.state.started
          current: unknown
    state:
      possible:
        - started:
            do: command to power on
            check: command to check
        - stopped:
            do: command to power off
            check: command to check
        - running:
            depends:
              - application['was_nd_855_app'].components.node['Dmgr'].state.started
              - application['was_nd_855_app'].components.node['Node1'].components.server['Server11'].state.started
              - application['was_nd_855_app'].components.node['Node1'].components.server['Server12'].state.started
              - application['was_nd_855_app'].components.node['Node1'].components.server['Server13'].state.started
      current: started
 
goal:
  - host['psh05'].state.running